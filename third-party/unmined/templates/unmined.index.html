<!DOCTYPE html>
<html>

<head>
    <title>BDSLM</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.2.0/js/bootstrap.min.js"></script>    

    <!-- OpenLayers CSS -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/css/ol.css"
        integrity="sha256-jckPZk66EJrEBQXnJ5QC2bD+GxWPDRVVoMGr5vrMZvM=" crossorigin="anonymous">

    <!-- OpenLayers JS -->
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/build/ol.js"
        integrity="sha256-77dogUPZ1WVoK9BDF0CxsKnAouX3YzK6n4tIcbDgtFI=" crossorigin="anonymous"></script>


    <!-- Map metadata generated by uNmINeD -->
    <script type="text/javascript" src="unmined.map.properties.js"></script>
    <script type="text/javascript" src="unmined.map.regions.js"></script>

    <!-- Custom markers -->
    <!-- <script type="text/javascript" src="custom.markers.js"></script> -->

    <!-- uNmINeD JS -->
    <script type="text/javascript" src="unmined.openlayers.js"></script>

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <style type="text/css">
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 100%;
            width: 100%;
            background-color: aqua;
            image-rendering: pixelated;
        }

        .mouseposition {
            background-color: white;
            padding: 3px;
            text-align: right;
        }

        .mousepositioncoord {
            min-width: 40px;
            display: inline-block;
        }

        div.ol-mouse-position {
            background-color: rgb(224, 224, 224);
            padding: 6px;
            border-radius: 3px;
            box-shadow: 3px 3px 2px rgba(0, 0, 0, 0.2);
        }

        #chatbox {
            position: absolute;
            bottom: 0;
            width: 400px;
            height: 300px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 3px;
            box-shadow: 3px 3px 2px rgba(0, 0, 0, 0.2);
            padding: 10px;
            resize: both;
        }
        #chatbox .btn-close {
            position: absolute;
            right: 5px;
        }
        #chatbox hr {
            margin: 10px 0;
        }
        #chat-messages {
            padding: 0 5px;
            overflow-y: scroll;
        }
        #chatbox .chat-message .name {
            font-weight: bold;
        }
        #chatbox .chat-message .content {
            padding: 10px;
            background: #fff;
            border-radius: 5px;
            overflow: hidden;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.06);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.08);
        }
        ::-webkit-scrollbar-thumb {
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.12);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
        }
    </style>

</head>

<body>
    <div id="map"></div>

    <div id="chatbox">
        <div class="header">
            <span class="h4">Chat</span>
            <button type="button" class="btn-close" aria-label="Close" onclick="onCloseChatBox()"></button>
        </div>
        <hr/>
        <div id="chat-messages">
            <div class="chat-message row">
                <div class="name">Jasonzyt</div>
                <div class="content">Hello</div>
            </div>
            <div class="chat-message row">
                <div class="name">Jasonzyt</div>
                <div class="content text-wrap">Hello aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</div>
            </div>
            <div class="chat-message row">
                <div class="name">Jasonzyt</div>
                <div class="content text-wrap">草草草草草草草草草草草草草草草草草草草</div>
            </div>
            <div class="chat-message row">
                <div class="name">Jasonzyt</div>
                <div class="content text-wrap">草草草草草草草草草草草草草草草草草草草</div>
            </div>
        </div>
    </div>

    <script type="text/javascript">

        if (UnminedMapProperties != null) {
            document.title = UnminedMapProperties.worldName + " - " + document.title;
        }

        //////// CHAT BOX ////////

        let boxX = 0;
        let boxY = 0;
        let mouseX = 0;
        let mouseY = 0;
        $('#chatbox').mousedown((ev) => {
            // Determine if the mouse is at the bottom-right corner of the chat box
            let x = ev.pageX - $('#chatbox').offset().left;
            let y = ev.pageY - $('#chatbox').offset().top;
            if (x > $('#chatbox').width() - 5 && y > $('#chatbox').height() - 5) {
                // Resize
                return;
            }

            boxX = $('#chatbox').offset().left;
            boxY = $('#chatbox').offset().top;
            mouseX = ev.clientX;
            mouseY = ev.clientY;
            $('#chatbox').css('cursor', 'move');
        });
        $('#chatbox').mousemove((ev) => {
            if (ev.buttons === 1) {
                let x = ev.pageX - $('#chatbox').offset().left;
                let y = ev.pageY - $('#chatbox').offset().top;
                if (x > $('#chatbox').width() - 5 && y > $('#chatbox').height() - 5) {
                    // Resize
                    return;
                }
                $('#chatbox').css('left', (boxX + ev.clientX - mouseX) + 'px');
                $('#chatbox').css('top', (boxY + ev.clientY - mouseY) + 'px');
            }
        });
        $('#chatbox').mouseup((ev) => {
            boxX = $('#chatbox').offset().left;
            boxY = $('#chatbox').offset().top;
            mouseX = ev.clientX;
            mouseY = ev.clientY;
            $('#chatbox').css('cursor', 'default');
        });

        function onCloseChatBox() {
            $('#chatbox').hide();
            
        }

        // if (UnminedCustomMarkers && UnminedCustomMarkers.isEnabled && UnminedCustomMarkers.markers) {
        //     UnminedMapProperties.markers = UnminedMapProperties.markers.concat(UnminedCustomMarkers.markers);
        // }
        try {
            let unmined = new Unmined();
            unmined.map('map', UnminedMapProperties, UnminedRegions);
        } catch (e) {
            console.log(e);
        }

    </script>
</body>

</html>